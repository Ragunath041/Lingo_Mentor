<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voice-Based Chatbot</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@openai/openai-js@0.5.1/dist/openai.js"></script>
<script>
  // Initialize OpenAI API
  openai.api_key = "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";

  // Function to start speech recognition
  function startSpeechRecognition() {
    var recognition = new webkitSpeechRecognition();
    recognition.continuous = false;
    recognition.interimResults = false;
    recognition.lang = 'en-US';
    
    recognition.onresult = function(event) {
      var transcript = event.results[0][0].transcript;
      $('#userInput').val(transcript);
      sendUserInput();
    };

    recognition.onerror = function(event) {
      console.error('Speech recognition error detected: ' + event.error);
    };

    recognition.onend = function() {
      console.log('Speech recognition ended.');
    };

    recognition.start();
  }

  // Function to send user input to chatbot
  function sendUserInput() {
    var userInput = $('#userInput').val();
    if (userInput.toLowerCase() === 'stop') {
      return;
    }
    $('#conversation').append('<div class="userMsg">' + userInput + '</div>');
    $('#userInput').val('');
    $.ajax({
      url: 'https://api.openai.com/v1/completions',
      type: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer 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'
      },
      data: JSON.stringify({
        model: 'gpt-3.5-turbo',
        prompt: $('#conversation').text() + 'User: ' + userInput + '\nAssistant:',
        max_tokens: 50
      }),
      success: function(response) {
        var assistantMsg = response.choices[0].text.trim();
        $('#conversation').append('<div class="assistantMsg">' + assistantMsg + '</div>');
        responsiveVoice.speak(assistantMsg, "UK English Male", {rate: 0.8});
      },
      error: function(xhr, status, error) {
        console.error('Error:', error);
      }
    });
  }
</script>
</head>
<body>
  <h1>Voice-Based Chatbot</h1>
  <div id="conversation"></div>
  <div>
    <textarea id="userInput" rows="4" cols="50"></textarea>
  </div>
  <div>
    <button onclick="startSpeechRecognition()">Start Recording</button>
  </div>
  <script src="https://code.responsivevoice.org/responsivevoice.js?key=YOUR_API_KEY"></script>
</body>
</html>
